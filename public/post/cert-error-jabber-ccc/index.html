<!DOCTYPE html>
<html class="no-js">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>CCC Jabber Connection  &middot; Magical Broccoli</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="jabber.ccc.de, Cert Error, Prosody, ">


<meta property="og:title" content="CCC Jabber Connection  &middot; Magical Broccoli ">
<meta property="og:site_name" content="Magical Broccoli"/>
<meta property="og:url" content="https://magicbroccoli.de/post/cert-error-jabber-ccc/" />
<meta property="og:locale" content="de-DE">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2017-08-28T13:30:00&#43;02:00" />
<meta property="og:article:modified_time" content="2017-08-28T13:30:00&#43;02:00" />

  
    
<meta property="og:article:tag" content="jabber.ccc.de">
    
<meta property="og:article:tag" content="Cert Error">
    
<meta property="og:article:tag" content="Prosody">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="CCC Jabber Connection" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://magicbroccoli.de/post/cert-error-jabber-ccc/" />
<meta name="twitter:domain" content="https://magicbroccoli.de/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "CCC Jabber Connection",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2017-08-28",
    "description": "",
    "wordCount": 468
  }
</script>



<link rel="canonical" href="https://magicbroccoli.de/post/cert-error-jabber-ccc/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://magicbroccoli.de/touch-icon-144-precomposed.png">
<link href="https://magicbroccoli.de/favicon.ico" rel="icon">

<meta name="generator" content="Hugo 0.26" />


  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

  <link rel="stylesheet" href="https://magicbroccoli.de/assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://magicbroccoli.de/assets/css/style.css">
  <link rel="stylesheet" href="https://magicbroccoli.de/assets/css/tomorrow-night.css">
  <link href='//fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>

</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-md navbar-light blog-header">
  <div class="container">
    <button class="navbar-toggler" type="button" data-toggle="collapse"
        data-target="#exCollapsingNavbar2"
        aria-controls="exCollapsingNavbar2" aria-expanded="false" aria-label="Toggle navigation">
      &#9776;
    </button>
    <div class="collapse navbar-collapse" id="exCollapsingNavbar2">
      <a class="navbar-brand" href="https://magicbroccoli.de/">Magical Broccoli</a>
      <ul class="nav navbar-nav">
        
        
          <li class="nav-item">
          <a class="nav-link menu-item" href="https://magicbroccoli.de/">
              <i class='fa fa-home fa-fw'></i>
              <span>Home</span>
          </a>
        </li>
        
          <li class="nav-item">
          <a class="nav-link menu-item" href="https://magicbroccoli.de/xmpp/">
              <i class='fa fa-delicious'></i>
              <span>XMPP</span>
          </a>
        </li>
        
          <li class="nav-item">
          <a class="nav-link menu-item" href="https://magicbroccoli.de/register/">
              <i class='fa fa-plus' fa-fw'></i>
              <span>Register</span>
          </a>
        </li>
        
          <li class="nav-item">
          <a class="nav-link menu-item" href="https://magicbroccoli.de/contact">
              <i class='fa fa-info-circle'></i>
              <span>About me</span>
          </a>
        </li>
        
      </ul>
    </div>
  </div>
</nav>

<div class="container p-a-0">
  <div class="row m-l-0 m-r-0">
    <div class="col-xs-12 col-md-9 post-container">
      <div>
  
<a href="https://magicbroccoli.de/post/cert-error-jabber-ccc/" itemprop="url">
    
      <img src="https://magicbroccoli.de/banner/ccc-header.png" class="img-fluid" alt="Generic responsive image">
    
</a>


  <h1 class="post-title">CCC Jabber Connection
</h1>

  <div class="post-meta">
  <div class="post-meta-item">
    <i class="fa fa-calendar"></i>
    <time datetime="2017-08-28">28 Aug, 2017</time>

    
      &middot; by nico
    
    &middot; 3 Minute Read
    &middot; 468 Words
  </div>

  
      
      
      <div class="post-meta-item">
          <i class="fa fa-folder-open-o"></i>
          
          <a class="article-category-link" href="https://magicbroccoli.de/categories/xmpp/">XMPP</a>
          &middot;
          
          <a class="article-category-link" href="https://magicbroccoli.de/categories/debian/">Debian</a>
          
          
      </div>
      
  

  
      
      
        <div class="post-meta-item">
          <i class="fa fa-tags"></i>
          
          <a href="https://magicbroccoli.de/tags/ca-bundle/">CA Bundle</a>
          &middot;
          
          <a href="https://magicbroccoli.de/tags/ccc/">CCC</a>
          &middot;
          
          <a href="https://magicbroccoli.de/tags/cert-error/">Cert Error</a>
          &middot;
          
          <a href="https://magicbroccoli.de/tags/prosody/">Prosody</a>
          
          
        </div>
      
  
  
  <div class="post-meta-item">
    &nbsp;<i class="fa fa-comment-o"></i>
    <a href="https://magicbroccoli.de/post/cert-error-jabber-ccc/#disqus_thread" class="article-comment-link">
         Comments
    </a>
  </div>
  

</div>

</div>

      <div class="content">
  

<h2 id="einleitung">Einleitung</h2>

<p>Der XMPP Server vom <a href="https://ccc.de" target="_blank">Chaos Computer Club</a> wird unter einem Zertifikat von <a href="https://cacert.org" target="_blank">cacert.org</a> betrieben. Das root Zertifikat wird allerdings von den meisten Browsern / Betriebssystemen nicht anerkannt. Dies stellt für die Erreichbarkeit des XMPP Servers ein Problem da.</p>

<p>Speziell Server die auf Datenschutz und Sicherheit ausgelegt wollen keine unverschlüsselten Verbindung.Im Folgenden möchte daher ich aufzeigen, welche Änderungen notwendig wären, um Debian mit den entsprechenden Zertifikaten auszustatten.</p>

<p>Betroffen sind damit speziell Prosody Server, die folgende Konfiguration eingestellt haben.</p>

<pre><code class="language-lua">s2s_require_encryption = true
s2s_secure_auth = true
</code></pre>

<p>Damit ist die Voraussetzung einer Verbindung ein Zertifikat, welches vom Server anerkannt wird. Da auch keine unverschlüsselte Verbindung aufgebaut werden kann, wird die Verbindung blockiert.
<a href="https://prosody.im/doc/s2s#security" target="_blank">Prosody S2S Security</a><br></p>

<p>Ein Verbindungsaufbau würde im Log dann so aussehen.</p>

<pre><code>mod_s2s	warn	Forbidding insecure connection to/from jabber.ccc.de
s2sin5637dae55f80	info	Incoming s2s stream jabber.ccc.de-&gt;magicbroccoli.de closed: Your server's certificate is invalid, expired, or not trusted by magicbroccoli.de
</code></pre>

<p>Es besteht die Möglichkeit Ausnahmen zu definieren, das Server trotz der Maßname, dass gültige Zertifikate präsentiert werden müssen, eine verschlüsselte Verbindung aufbauen können.<br>
<strong>IMHO</strong>: <em>Ich persönlich halte nichts davon Ausnahmen in einer Sicherheitsrichtlinie zu definieren. Ich weigere mich ein Pflaster System zu unterstützen, daher wird es unter <a href="//magicbroccoli.de" target="_blank">magicbroccoli.de</a> keine Ausnahmen geben.</em></p>

<ul>
<li><a href="https://magicbroccoli.de/technik/#verschlüsselung">Technik/Verschlüsselung</a></li>
<li><a href="https://magicbroccoli.de/technik/#zertifikate">Technik/Zertifikate</a></li>
</ul>

<h2 id="root-zertifikate-hinzufügen">Root Zertifikate hinzufügen</h2>

<p>Es wichtig die Integrität des Systems zu erhalten, daher werden keine Systemdateien geändert und Dateien nur an Stellen eingefügt, wo allein der Pfad schon erkennbar macht, dass diese eine <em>manuelle</em> Erweiterung sind.</p>

<pre><code>/usr/local/share/ca-certificates
</code></pre>

<p>In diesem Verzeichnis sollten grundsätzlich keine Dateien oder Ordner vorhanden sein. Dieses Verzeichnis fügt für alle <em>lokalen</em> User Certificate Authorities ( <em>im Folgenden nur noch CA genannt</em> ) Zertifikate ein.</p>

<p><strong>Hinweis</strong>: <em>Das Hinzufügen eines CA Root Zertifikats kann das System einem erhöhten Risiko aussetzen. Es sollte sehr vorsichtig mit der Beglaubigung von wildfremden CAs umgegangen werden. Da euer System mit den folgenden Änderungen auch allen beglaubigten Zertifikaten der CA vertraut.</em></p>

<p>In diesem Verzeichnis ist ein Ordner zu erstellen mit dem Namen der CA.<br></p>

<pre><code class="language-#!/bin/bash">sudo mkdir /usr/local/share/ca-certificates/cacert.org
</code></pre>

<h3 id="download-der-zertifikate">Download der Zertifikate</h3>

<pre><code class="language-#!/bin/bash">sudo wget -P /usr/local/share/ca-certificates/cacert.org \
http://www.cacert.org/certs/root.crt \
http://www.cacert.org/certs/class3.crt
</code></pre>

<h2 id="aktualisieren-des-zertifikat-bündels">Aktualisieren des Zertifikat Bündels</h2>

<p>Zum Schluss muss der Zertifikat Speicher des System noch aktualisiert werden. Hierfür wird das Verzeichnis ausgelesen und alle Zertifikate die dort vorhanden sind werden hinzugefügt.</p>

<pre><code class="language-#!/bin/bash">sudo update-ca-certificates
</code></pre>

<h2 id="entfernen-von-ca-root-zertifikaten">Entfernen von CA Root Zertifikaten</h2>

<p><em><strong>VORSICHT</strong></em><br>
Falls es, weswegen auch immer, gewollt ist einer CA und deren Zertifikaten nicht mehr zu vertrauen, sind die Schritte wie folgt.</p>

<p>Es ist hier eine enorme Vorsicht geboten. Lieber sollte ein move Befehl verwendet werden, wenn es auch nur den Hauch eins Zweifels gibt. Außerdem sollte nur jemand der genau weiß was er tut überhaupt an den Zertifikaten des Systems arbeiten.</p>

<p>Im Folgenden am Beispiel von cacert.org.</p>

<ul>
<li><p>Entfernen der Zertifikate/ des Zertifikat-Ordners aus</p>

<pre><code class="language-#!/bin/bash">sudo rm -r /usr/local/share/ca-certificates/cacert.org/
</code></pre></li>

<li><p>löschen und neuerstellen der Symlinks</p>

<pre><code class="language-#!/bin/bash">sudo update-ca-certificates --fresh
</code></pre>

<p>Mit diesen beiden Befehlen ist es möglich, jegliche CA aus dem trust store zu entfernen.</p></li>
</ul>

</div>

      <footer>
    
    
      
        <nav><ul class="pagination">
        
            <li class="page-item">
              <a href="https://magicbroccoli.de/post/database_failure/" title="Datenbank Zusammenbruch " class="page-link">
                <span aria-hidden="true">&larr;</span>Previous
              </a>
            </li>
        

        
        </ul> </nav>
      
    

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      (function() {
        
        
        if (window.location.hostname == "localhost")
          return;

        var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
        dsq.src = '//xxxxxx.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
  </div>
</footer>

    </div>
      <div class="col-xs-12 col-md-3">
        <div class="sidebar">
  

  


<div class="card card-block">
  <h4 class="card-title">CATEGORIES</h4>
  <div class="card-text">
    <div class="widget">
      <ul>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/bash/">
                bash
            </a>
            <span class="category-list-count">1</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/debian/">
                debian
            </a>
            <span class="category-list-count">2</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/development/">
                development
            </a>
            <span class="category-list-count">1</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/gajim/">
                gajim
            </a>
            <span class="category-list-count">1</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/mariadb/">
                mariadb
            </a>
            <span class="category-list-count">1</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/omemo/">
                omemo
            </a>
            <span class="category-list-count">1</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/prosody/">
                prosody
            </a>
            <span class="category-list-count">2</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/teamspeak/">
                teamspeak
            </a>
            <span class="category-list-count">1</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/xep-0368/">
                xep-0368
            </a>
            <span class="category-list-count">1</span>
        </li>
        
        <li class="category-list-item">
            <a href="https://magicbroccoli.de/categories/xmpp/">
                xmpp
            </a>
            <span class="category-list-count">4</span>
        </li>
        
      </ul>
    </div>
  </div>
</div>




  



<div class="card card-block">
  <h4 class="card-title">TAGS</h4>
  <div class="card-text">
    <div class="widget">
      <ul>
        
          <li>
            <a href="https://magicbroccoli.de/tags/ca-bundle/">ca-bundle</a>
            <span class="category-list-count">1</span>
          </li>
        
          <li>
            <a href="https://magicbroccoli.de/tags/ccc/">ccc</a>
            <span class="category-list-count">1</span>
          </li>
        
          <li>
            <a href="https://magicbroccoli.de/tags/cert-error/">cert-error</a>
            <span class="category-list-count">1</span>
          </li>
        
          <li>
            <a href="https://magicbroccoli.de/tags/failure/">failure</a>
            <span class="category-list-count">1</span>
          </li>
        
          <li>
            <a href="https://magicbroccoli.de/tags/guide/">guide</a>
            <span class="category-list-count">1</span>
          </li>
        
          <li>
            <a href="https://magicbroccoli.de/tags/mariadb/">mariadb</a>
            <span class="category-list-count">1</span>
          </li>
        
          <li>
            <a href="https://magicbroccoli.de/tags/omemo/">omemo</a>
            <span class="category-list-count">1</span>
          </li>
        
          <li>
            <a href="https://magicbroccoli.de/tags/prosody/">prosody</a>
            <span class="category-list-count">3</span>
          </li>
        
          <li>
            <a href="https://magicbroccoli.de/tags/xmpp/">xmpp</a>
            <span class="category-list-count">3</span>
          </li>
        
      </ul>
    </div>
  </div>
</div>




  


<div class="card card-block">
  <h4 class="card-title">TAG CLOUD</h4>
  <p class="card-text">
    
        <a href="https://magicbroccoli.de/tags/ca-bundle/" class="badge badge-primary">
        ca-bundle
        </a>
    
        <a href="https://magicbroccoli.de/tags/ccc/" class="badge badge-primary">
        ccc
        </a>
    
        <a href="https://magicbroccoli.de/tags/cert-error/" class="badge badge-primary">
        cert-error
        </a>
    
        <a href="https://magicbroccoli.de/tags/failure/" class="badge badge-primary">
        failure
        </a>
    
        <a href="https://magicbroccoli.de/tags/guide/" class="badge badge-primary">
        guide
        </a>
    
        <a href="https://magicbroccoli.de/tags/mariadb/" class="badge badge-primary">
        mariadb
        </a>
    
        <a href="https://magicbroccoli.de/tags/omemo/" class="badge badge-primary">
        omemo
        </a>
    
        <a href="https://magicbroccoli.de/tags/prosody/" class="badge badge-primary">
        prosody
        </a>
    
        <a href="https://magicbroccoli.de/tags/xmpp/" class="badge badge-primary">
        xmpp
        </a>
    
  </p>
</div>




</div>

      </div>
  </div>
</div>
      <footer class="footer hidden-print">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-md-9">
        <p class="text-xs-center m-a-0 p-a-0">
          &copy; 2017 All rights reserved.
        </p>
        <p class="text-xs-center  m-a-0 p-a-0">
            
          <span class="p-l-1 p-r-1">
                <a href="https://magicbroccoli.de/impressum/">Impressum</a>
              </span>
              &middot; 
          <span class="p-l-1 p-r-1">
                <a href="https://magicbroccoli.de/termsofuse/">Terms of Use</a>
              </span>
              &middot; 
          <span class="p-l-1 p-r-1">
                <a href="https://magicbroccoli.de/datenschutz/">Privacy Policy</a>
              </span>
                
        </p>

      </div>
    </div>
  </div>
</footer>
    
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

<script src="https://magicbroccoli.de/assets/js/highlight.pack.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


<script id="dsq-count-scr" src="//xxxxxx.disqus.com/count.js" async></script>


<script src="https://magicbroccoli.de/assets/js/script.js"></script>




<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.conversejs.org/css/converse.min.css">
<script>
  if ( screen && screen.width > 960 ) {
  document.write('<script type="text\/javascript" src="https://cdn.conversejs.org/dist/converse.min.js"><\/script>');
  }
</script>
<script>
  converse.initialize({
  allow_chat_pending_contacts: true,
  allow_non_roster_messaging: true,
  allow_registration: false,
  bosh_service_url: 'https://magicbroccoli.de/http-bind',
  csi_waiting_time: 25,
  domain_placeholder: 'magicbroccoli.de',
  default_domain: 'magicbroccoli.de',
  message_carbons: true,
  muc_domain: 'conference.magicbroccoli.de',
  providers_link: 'https://magicbroccoli.de/xmpp',
  registration_domain: 'magicbroccoli.de',
  roster_groups: true,
  show_controlbox_by_default: true,
  show_send_button: true,
  });
</script>

  </body>
</html>

